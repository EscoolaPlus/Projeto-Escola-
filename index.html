<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ESCOLA+ - Sua Plataforma Educacional</title>
    <link rel="stylesheet" href="style.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  </head>

  <body class="tema-geral bdy-geral disp-flex-dirct">
    <div id="menu-container"></div>

    <div id="main-screen" class="container">
      <header class="header">
        <div id="menu-element" style="width: 33%"></div>
        <div style="width: 34%; display: flex; justify-content: center">
          <p id="header-title">Início</p>
        </div>
        <div class="header-logo">ESCOLA<span>+</span></div>
      </header>

      <div class="content">
        <!-- Seção de Notícias -->
        <div style="text-align: center; margin-bottom: 15px;">
          <h2 style="color: var(--azul-escuro); font-size: 1.5rem; margin-bottom: 5px;">
            <i class="fas fa-newspaper" style="margin-right: 8px;"></i>Últimas Notícias
          </h2>
          <p style="color: var(--cinza-escuro); font-size: 0.95rem;">
            Acompanhe as novidades da Câmara Municipal
          </p>
        </div>

        <div class="carousel">
          <div class="carousel-wrapper">
            <a id="carousel-link" href="#" target="_blank" class="carousel-link">
              <div id="carousel-item" class="carousel-item" style="background-color: #003366; background-size: cover; background-position: center;">
                <h2 id="news-date">Acessando portal...</h2>
                <p id="news-text">Carregando as últimas notícias da Câmara de Santarém.</p>
              </div>
            </a>
          </div>
          <div class="carousel-indicators" id="carousel-indicators"></div>
        </div>

        <!-- Seção de Apresentação -->
        <div style="text-align: center; margin: 30px auto; max-width: 800px;">
          <h2 style="color: var(--azul-escuro); font-size: 1.8rem; margin-bottom: 15px;">
            Cidadania, Cultura e Inovação!
          </h2>
          <p style="color: #555; font-size: 1.05rem; line-height: 1.6;">
            A Escola do Legislativo de Santarém agora cabe no seu bolso. Aprenda brincando com nossos jogos, explore documentos históricos na Biblioteca Virtual e fique por dentro dos debates ouvindo nosso Podcast. Educação e cidadania, a um toque de distância.          </p>
        </div>

        <div class="container" style="margin-top: 20px;">
        <div class="content" style="text-align: center; padding: 20px;">
            <h2 style="color: var(--azul-escuro); margin-bottom: 10px;">Explore o ESCOLA+</h2>
            <p style="color: var(--cinza-escuro); margin-bottom: 25px;">O que você quer aprender ou jogar hoje?</p>
            
            <div class="incentive-grid">
                <a href="biblioteca.html" class="incentive-card">
                    <i class="fas fa-book-open"></i>
                    <span>Biblioteca</span>
                </a>
                
                <a href="jogos.html" class="incentive-card orange">
                    <i class="fas fa-gamepad"></i>
                    <span>Jogos</span>
                </a>
            </div>
        </div>
    </div>
    
    </div>
    <div id="footer-container"></div>

    <script src="menu-loader.js"></script>
    <script src="footer-loader.js"></script>
    <script>
      if (window.loadMenu) window.loadMenu();

      // Buscar Notícias
      async function carregarNoticias() {
        const noticiasFallback = [
           { data: "Hoje", titulo: "Bem-vindo ao ESCOLA+", link: "#", imagem: "https://via.placeholder.com/1200x600?text=Bem-vindo" },
           { data: "Institucional", titulo: "Conheça nossa Biblioteca Virtual", link: "biblioteca.html", imagem: "https://via.placeholder.com/1200x600?text=Biblioteca" }
        ];

        const apiURL = "https://santarem.pa.leg.br/wp-json/wp/v2/posts?_embed&per_page=5";
        const proxyURL = `https://corsproxy.io/?${encodeURIComponent(apiURL)}`;

        try {
          const response = await fetch(proxyURL);
          if (!response.ok) throw new Error("Erro na rede ou proxy");
          
          const posts = await response.json();
          
          const noticias = posts.map(post => {
            let img = "https://via.placeholder.com/1200x600?text=Câmara+Municipal+de+Santarém";
            if (post._embedded && post._embedded['wp:featuredmedia']) {
              img = post._embedded['wp:featuredmedia'][0].source_url;
            }
            return {
              data: new Date(post.date).toLocaleDateString('pt-BR'),
              titulo: post.title.rendered,
              link: post.link,
              imagem: img
            };
          });

          iniciarCarrossel(noticias.length > 0 ? noticias : noticiasFallback);
        } catch (error) {
          console.error("Usando notícias de fallback devido a erro:", error);
          iniciarCarrossel(noticiasFallback);
        }
      }

      function iniciarCarrossel(lista) {
        let i = 0;
        let intervalId = null;
        let touchStartX = 0;
        let touchEndX = 0;
        
        const item = document.getElementById("carousel-item");
        const date = document.getElementById("news-date");
        const text = document.getElementById("news-text");
        const link = document.getElementById("carousel-link");
        const indicatorsContainer = document.getElementById("carousel-indicators");
        const wrapper = document.querySelector(".carousel-wrapper");

        lista.forEach((_, index) => {
          const indicator = document.createElement("div");
          indicator.className = `carousel-indicator ${index === 0 ? 'active' : ''}`;
          indicator.addEventListener("click", () => goToSlide(index));
          indicatorsContainer.appendChild(indicator);
        });

        // Pré-carregar primeira imagem
        const img = new Image();
        img.src = lista[0].imagem;

        function updateIndicators() {
          document.querySelectorAll(".carousel-indicator").forEach((ind, idx) => {
            ind.classList.toggle("active", idx === i);
          });
        }

        function goToSlide(index) {
          if (index === i) return;
          i = index;
          slide();
          resetInterval();
        }

        function slide() {
          const n = lista[i];

          item.style.transform = "translateX(-20px)";
          item.style.opacity = "0";
          
          setTimeout(() => {
            item.style.backgroundImage = `url('${n.imagem}')`;
            date.textContent = n.data;
            text.innerHTML = n.titulo;
            link.href = n.link;
            
            item.style.transform = "translateX(0)";
            item.style.opacity = "1";
            
            updateIndicators();
            
            const nextIndex = (i + 1) % lista.length;
            const nextImg = new Image();
            nextImg.src = lista[nextIndex].imagem;
            
          }, 500);
        }

        function nextSlide() {
          i = (i + 1) % lista.length;
          slide();
        }

        function prevSlide() {
          i = (i - 1 + lista.length) % lista.length;
          slide();
        }

        function resetInterval() {
          if (intervalId) clearInterval(intervalId);
          intervalId = setInterval(nextSlide, 7000);
        }

        // Gestos touch para swipe
        wrapper.addEventListener("touchstart", (e) => {
          touchStartX = e.changedTouches[0].screenX;
        }, { passive: true });

        wrapper.addEventListener("touchend", (e) => {
          touchEndX = e.changedTouches[0].screenX;
          handleSwipe();
        }, { passive: true });

        function handleSwipe() {
          const swipeThreshold = 50;
          const diff = touchStartX - touchEndX;
          
          if (Math.abs(diff) > swipeThreshold) {
            if (diff > 0) {
              nextSlide();
            } else {
              prevSlide();
            }
            resetInterval();
          }
        }

        wrapper.addEventListener("mouseenter", () => {
          if (intervalId) clearInterval(intervalId);
        });

        wrapper.addEventListener("mouseleave", () => {
          resetInterval();
        });
        
        slide();
        resetInterval();
      }
      carregarNoticias();
    </script>
  </body>
</html>